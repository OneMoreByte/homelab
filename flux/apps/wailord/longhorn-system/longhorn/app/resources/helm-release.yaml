apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: longhorn
spec:
  interval: 1h
  chart:
    spec:
      chart: longhorn
      version:  1.10.1
      sourceRef:
        kind: HelmRepository
        name: longhorn-repo
  install:
    remediation:
      retries: -1
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  values:
    longhornManager:
      log:
        format: json
    longhornDriver:
      log:
        format: json
    persistence:
      defaultClass: true
      defaultFsType: ext4
      defaultClassReplicaCount: 3
      defaultDataLocality: best-effort
      storageOverProvisioningPercentage: "300"
    preUpgradeChecker:
      jobEnabled: false
    defaultSettings:
      defaultDataPath: "/var/mnt/longhorn"
    defaultBackupStore:
      backupTarget: "s3://longhorn-backup@home/"
      backupTargetCredentialSecret: "s3-backup-secret"

    httproute:
      enabled: true
      parentRefs:
        - name: "internal"
          namespace: "gateway-svcs"
          sectionName: websecure-gw
      hostnames:
        - "longhorn.jsck.network"
