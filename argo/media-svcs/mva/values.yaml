# Default values for mva.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: wiserain/flexget:3.3.17
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

podSecurityContext:
  runAsUser: 11337
  runAsGroup: 11337
  fsGroup: 11337

service:
  type: ClusterIP
  port: 3000


serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""


resources:
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  requests:
    cpu: 100m
    memory: 128Mi


ingress:
  main:
    enabled: true
    primary: true
    annotations:
      traefik.ingress.kubernetes.io/router.tls: "true"
      traefik.ingress.kubernetes.io/router.entrypoints: websecure,web
    labels: {}
    hosts:
      - host: flexget.jackhil.de
        paths:
          - path: /
            pathType: Prefix
    tls:
      - hosts:
         - flexget.jackhil.de
        secretName: jackhil.de-cert
  ssl-redirect:
    enabled: true
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: web
      traefik.ingress.kubernetes.io/router.middlewares: traefik-redirect-http-2-https@kubernetescrd
    labels: {}
    hosts:
      - host: flexget.jackhil.de
        paths:
          - path: /
            pathType: Prefix

nodeSelector: {}

tolerations: []

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: app
          operator: In
          values:
          - bulk-datastore



flexget_config:
  web_server:
    bind: 0.0.0.0
    port: 3000
    web_ui: yes

  variables:
    plex_base_dir: "/store/plex-files"
    torrent_base_dir: "/torrents"
    plex_dirs:
      anime: '{? plex_base_dir ?}/Anime/MKV'
      shows: '{? plex_base_dir ?}/Shows/MKV'
      movies: '{? plex_base_dir ?}/Movies/MKV'
    torrent_dirs:
      public:
        watch_dir: "/torrents/public/watch/mva"
        complete_dir: "/torrents/public/complete"
      private:
        watch_dir: "/torrents/private/watch"
        complete_dir: "/torrents/private/downloads/auto"
    discord_webhook: 'https://discord.com/api/webhooks/1002624119642267648/kW3New1lThMUept9isSMblCtuTDWC1ZtMas5sF7Vaawkr2ZhccGgN6TJUD4dZP_c4zdv'
    thetvdb:
      username: jsck
      account_id: FR1WAS9R0Q3ECOMX
      api_key: 8ba8af3cdada63b2594be6a6e298428f
    rss_feeds:
      subsplease: 'https://subsplease.org/rss/?r=1080'
      morethantv: 'https://www.morethantv.me/feeds.php?feed=torrents_all&user=35591&auth=bc57fffbec10ab271ff94df35bcb3399&passkey=met6q0xshpuo0nlitxoyciaz7b8me85r&authkey=f78acf3c0b53b84db57eeebabfeb4dc2'


  templates:
    anchors:
      _discord_webhook_show: &discord_webhook_show
        via:
          - discord:
              web_hook_url: '{? discord_webhook ?}'
              username: 'mva'
              embeds:
              - title: "{{series_name}}"
                description: ""
                url: "{{tvdb_url}}"
                color: 0x00FFFF
                author:
                  name: "mva"
                  url: "https://github.com/onemorebyte/homelab"
                  icon_url: "https://divedigital.id/wp-content/uploads/2022/07/1-Anya-Forger-HEH-Face.jpg"
                fields:
                  - name: "Episode Name:"
                    value: "{{tvdb_ep_name|default('Unknown episode')}}"
                    inline: True
                  - name: "Episode Number"
                    value: "{{tvdb_episode | default(series_episode) | default('<:CatShrug:757101278659739780>') }}"
                image:
                  url: "{{tvdb_ep_image | default('https://i.imgflip.com/j69nf.jpg')}}"


  tasks:
    subsplease_add:
      rss: '{? rss_feeds["subplease"] ?}'
      thetvdb_lookup: yes
      configure_series:
        from:
          my_anime_list:
            username: jsck
            status:
              - watching
              - plan_to_watch
            type: tv
      notify:
        entries:
          message: |
            Grabbing torrent for {{tvdb_series_name | default(series_name)}} - {{ tvdb_series_id| default(series_id) }} to:
            ```{? plex_dirs['anime'] ?}/{{ tvdb_series_name | default(series_name)}}/Season {{tvdb_season | default(series_season) | pad(2)}}```
          <<: *discord_webhook_show
      rtorrent_magnet: '{? torrent_dirs["public"]["complete_dir"] ?}'


    morethantv_add:
      rss: '{? rss_feeds["morethantv"] ?}'
      configure_series:
        from:
          thetvdb_list:
            username: '{? thetvdb["username"] ?}'
            account_id: '{? thetvdb["account_id"] ?}'
            api_key: '{? thetvdb["api_key"] ?}'
      notify:
        entries:
          message: |
            Grabbing torrent for {{tvdb_series_name | default(series_name)}} - {{ tvdb_series_id| default(series_id) }} to:
            ```{? plex_dirs['anime'] ?}/{{ tvdb_series_name | default(series_name)}}/Season {{tvdb_season | default(series_season) | pad(2)}}```
          <<: *discord_webhook_show
      rtorrent_magnet: '{? torrent_dirs["public"]["watch_dir"] ?}/morethantv'


    morethantv_copy:
      disable:
        - seen
      thetvdb_lookup: yes
      filesystem: 
        path: '{? torrent_dirs["private"]["complete_dir"] ?}/morethantv/'
        retrieve: files
      metainfo_series: yes
      parsing:
        series: guessit
      accept_all: yes
      notify:
        entries:
          message: |
            Copying {{tvdb_series_name | default(series_name)}} - {{ tvdb_series_id| default(series_id) }} to:
            ```{? plex_dirs['shows'] ?}/{{ tvdb_series_name | default(series_name)}}/Season {{tvdb_season | default(series_season) | pad(2)}}```
          <<: *discord_webhook_show
      copy:
        to: '{? plex_dirs["shows"] ?}/{{ tvdb_series_name | default(series_name)}}/Season {{tvdb_season | default(series_season) | pad(2)}}'
        rename: '{{tvdb_series_name | default(series_name)}} - {{ tvdb_series_id | default(series_id) | pad(2)}}{{ location|pathext }}'

    subsplease_move:
      disable:
        - seen
      thetvdb_lookup: yes
      filesystem: 
        path: '{? torrent_dirs["public"]["complete_dir"] ?}'
        retrieve: files
      manipulate:
      # Subsplease sometimes has v2 if their automation fucks up
        - title:
            replace:
              regexp: '- (\d+)v\d'
              format: '- \1'
      # the lookup scripts really don't like when we use 
        - title:
            replace:
              regexp: ' S(\d+) - '
              format: ' - s\1e'

      metainfo_series: yes
      parsing:
        series: guessit
      accept_all: yes
      notify:
        entries:
          message: |
            Moving {{tvdb_series_name | default(series_name)}} - {{ tvdb_series_id| default(series_id) }} to:
            ```{? plex_dirs['anime'] ?}/{{ tvdb_series_name | default(series_name)}}/Season {{tvdb_season | default(series_season) | pad(2)}}```
          <<: *discord_webhook_show
      move:
        to: '{? plex_dirs["anime"] ?}/{{ tvdb_series_name | default(series_name)}}/Season {{tvdb_season | default(series_season) | pad(2)}}'
        rename: '{{tvdb_series_name | default(series_name)}} - {{ tvdb_series_id | default(series_id) | pad(2)}}{{ location|pathext }}'



flexget_config_old:
  tasks:
    subsplease_add:
      rss: 'https://subsplease.org/rss/?r=1080'
      series:
      - Appare-Ranman!
      - Gleipnir
      - Yesterday wo Utatte
      - Nami yo Kiitekure
      - Hamefura
      - Tower of God
      - Plunderer
      - The God of High School
      - Re Zero kara Hajimeru Isekai Seikatsu
      - Deca-Dence
      - No Guns Life
      - Maou Gakuin no Futekigousha
      # Subsplease cutoff
      - Dungeon ni Deai wo Motomeru no wa Machigatteiru Darou ka S3
      - Akudama Drive
      - Jujutsu Kaisen
      - Enen no Shouboutai S2 
      - Tensei Shitara Slime Datta Ken 
      - Dr. Stone S2
      - Yuru Camp S2
      - Yakusoku no Neverland S2
      - Mars Red
      - Odd Taxi
      - Full Dive
      - Zombieland Saga S2
      - Isekai Maou to Shoukan Shoujo no Dorei Majutsu S2
      - Kumo desu ga, Nani ka
      - SSSS.Dynazenon
      - Mashiro no Oto
      - Boku no Hero Academia
      - Ijiranaide, Nagatoro-san
      - Vivy – Fluorite Eye’s Song
      - 86 - Eighty Six
      - Shadows House
      - Tokyo Revengers
      - Nomad - Megalo Box 2
      - Fumetsu no Anata e
      - Edens Zero
      - Slime Taoshite 300-nen, Shiranai Uchi ni Level Max ni Nattemashita
      - Vanitas no Karte # Not on subsplease
      - Kobayashi-san Chi no Maid Dragon S2
      - Tantei wa Mou, Shindeiru.
      - Sonny Boy
      - Jahy-sama wa Kujikenai!
      - Kaizoku Oujo
      - Heion Sedai no Idaten-tachi
      - Tsuki ga Michibiku Isekai Douchuu
      - Shinigami Bocchan to Kuro Maid
      - Sekai Saikou no Ansatsusha, Isekai Kizoku ni Tensei suru
      - Takt Op. Destiny
      - Platinum End
      - Saihate no Paladin
      - Sakugan
      - Shin no Nakama
      - Komi-san wa, Comyushou desu.
      - Ousama Ranking
      - Kimetsu no Yaiba – Yuukaku-hen
      - Shingeki no Kyojin (The Final Season)
      - Genjitsu Shugi Yuusha no Oukoku Saikenki
      - Spy x Family
      - Tomodachi Game
      - Tate no Yuusha no Nariagari S2
      - Kono Healer, Mendokusai
      - Kaguya-sama wa Kokurasetai S3
      - Kawaii dake ja Nai Shikimori-san
      - Birdie Wing - Golf Girls' Story
      - Overlord IV
      - Made in Abyss - Retsujitsu no Ougonkyou
      - Youkoso Jitsuryoku Shijou Shugi no Kyoushitsu e S2
      - Dungeon ni Deai wo Motomeru no wa Machigatteiru Darou ka S4
      - Hataraku Maou-sama S2
      - Shadows House S2
      - Lycoris Recoil
      - Chainsaw Man
      - Mob Psycho 100 S3
      - Fumetsu no Anata e S2
      - Tensei shitara Ken Deshita
      - Urusei Yatsura
#      - "BLEACH: Sennen Kessen-hen"
      - Do It Yourself!!

